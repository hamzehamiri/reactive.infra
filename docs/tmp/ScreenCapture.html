<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #video {
            border: 1px solid #999;
            width: 98%;
            max-width: 860px;
        }

        #log {
            width: 25rem;
            height: 15rem;
            border: 1px solid black;
            padding: 0.5rem;
            overflow: scroll;
        }
    </style>
    <script type="text/javascript">

        window.onload = ev => {
            async function startCapture() {
                logElem.innerHTML = "";

                try {
                    videoElem.srcObject =
                        await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);
                    dumpOptionsInfo();
                } catch (err) {
                    console.error(err);
                }
            }

            function stopCapture(evt) {
                let tracks = videoElem.srcObject.getTracks();

                tracks.forEach((track) => track.stop());
                videoElem.srcObject = null;
            }

            function dumpOptionsInfo() {
                const videoTrack = videoElem.srcObject.getVideoTracks()[0];

                console.log("Track settings:");
                console.log(JSON.stringify(videoTrack.getSettings(), null, 2));
                console.log("Track constraints:");
                console.log(JSON.stringify(videoTrack.getConstraints(), null, 2));
            }

            async function trackVideo(){
                const controller = new CaptureController();
// Prompt the user to share a tab, window, or screen.
                const stream = await navigator.mediaDevices.getDisplayMedia({ controller });

// Query the displaySurface value of the captured video track
                const [track] = stream.getVideoTracks();
                const displaySurface = track.getSettings().displaySurface;

                if (displaySurface === "browser") {
                    // Focus the captured tab.
                    controller.setFocusBehavior("focus-captured-surface");
                } else if (displaySurface === "window") {
                    // Do not move focus to the captured window.
                    // Keep the capturing page focused.
                    controller.setFocusBehavior("no-focus-change");
                }
            }

            const videoElem = document.getElementById("video");
            const logElem = document.getElementById("log");
            const startElem = document.getElementById("start");
            const stopElem = document.getElementById("stop");
            const sendElem = document.getElementById("Send");

            // Options for getDisplayMedia()

            const displayMediaOptions = {
                video: {
                    displaySurface: "window",
                },
                audio: false,
            };

            // Set event listeners for the start and stop buttons
            startElem.addEventListener(
                "click",
                (evt) => {
                    startCapture();
                },
                false,
            );

            stopElem.addEventListener(
                "click",
                (evt) => {
                    stopCapture();
                },
                false,
            );
            sendElem.addEventListener("click" , ev1 => {
                trackVideo();
            });
        }
    </script>
</head>
<body>

<p>
    This example shows you the contents of the selected part of your display.
    Click the Start Capture button to begin.
</p>

<p>
    <button id="start">Start Capture</button>&nbsp;
    <button id="stop">Stop Capture</button>
    <button id="Send">Send Capture</button>
</p>

<video id="video" autoplay></video>
<br/>

<strong>Log:</strong>
<br/>
<pre id="log"></pre>
</body>
</html>